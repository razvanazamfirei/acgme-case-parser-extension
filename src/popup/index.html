<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./popup.css" />
    <title>ACGME Case Submitter</title>
  </head>
  <body class="relative w-[600px] min-h-[400px] max-h-[600px] overflow-hidden">
    <!-- Confirmation Modal (shown on first run) -->
    <div
      id="confirmationModal"
      class="hidden absolute inset-0 bg-white z-50 flex flex-col overflow-y-auto"
    >
      <div class="p-5 space-y-4">
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
          <h2 class="text-base font-bold text-amber-900">
            Authorization Required
          </h2>
          <p class="text-sm text-amber-800 mt-1">
            This extension is restricted to authorized anesthesia residents at
            the University of Pennsylvania Health System (UPHS) with valid ACGME
            ADS credentials.
          </p>
        </div>

        <div
          class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-xs text-gray-700 space-y-2"
        >
          <p class="font-semibold text-gray-800">Disclaimer</p>
          <p>
            This tool is an independent project and is
            <strong>not affiliated with, endorsed by, or sponsored by ACGME</strong>.
            It does not bypass access controls and is not a scraping or data
            mirroring tool.
          </p>
          <p>
            Use only with your own authorized ADS credentials and only in
            accordance with your program's policies and ACGME Terms of Use. All
            case data is processed locally on your device and never transmitted
            to any external server.
          </p>
          <p>
            Bulk automation (BEAST Mode) requires explicit program approval
            before use.
          </p>
        </div>

        <div class="space-y-3">
          <div class="form-field">
            <label for="confirmInstitution"
              >Primary Institution (sets default for case submission)</label
            >
            <select id="confirmInstitution">
              <option value="HUP">HUP (Hospital of the University of Pennsylvania)</option>
              <option value="PPMC">PPMC (Penn Presbyterian Medical Center)</option>
              <option value="Penn Hospital">Pennsylvania Hospital</option>
              <option value="CHOP">CHOP (Children's Hospital of Philadelphia)</option>
            </select>
          </div>

          <label class="flex items-start gap-2 cursor-pointer">
            <input
              type="checkbox"
              id="confirmCheckbox"
              class="mt-0.5 flex-shrink-0"
            />
            <span class="text-sm text-gray-700">
              I confirm that I am an anesthesia resident at UPHS with authorized
              ACGME ADS access, and I agree to use this tool only for my own
              case log submissions in accordance with program policies and ACGME
              Terms of Use.
            </span>
          </label>

          <label class="flex items-start gap-2 cursor-pointer">
            <input
              type="checkbox"
              id="confirmAccuracyCheckbox"
              class="mt-0.5 flex-shrink-0"
            />
            <span class="text-sm text-gray-700">
              I understand that I am solely responsible for verifying the
              accuracy of all submitted case data. Values auto-populated by
              this tool — including those submitted in bulk via BEAST Mode —
              must be reviewed for correctness before submission. I will not
              use BEAST Mode without verifying case mappings on a sample of
              cases first.
            </span>
          </label>
        </div>

        <div class="flex gap-2">
          <button
            type="button"
            id="declineBtn"
            class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium cursor-pointer bg-white text-gray-700 hover:bg-gray-50"
          >
            Decline
          </button>
          <button
            type="button"
            id="confirmBtn"
            disabled
            class="flex-1 inline-flex items-center justify-center px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-40 disabled:cursor-not-allowed"
          >
            Confirm Access
          </button>
        </div>

        <div
          id="declineMessage"
          class="hidden p-3 bg-red-50 border border-red-200 rounded-md text-sm text-red-700"
        >
          This extension is restricted to authorized UPHS anesthesia residents.
          You may close this popup.
        </div>

        <p class="text-xs text-gray-400 text-center">
          This confirmation is stored locally and will not be requested again on
          this device.
        </p>
      </div>
    </div>

    <div class="flex flex-col h-full">
      <!-- Header -->
      <header class="bg-white border-b px-6 py-4">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-xl font-semibold text-gray-900">
              ACGME Case Submitter
            </h1>
            <p class="text-sm text-gray-500 mt-0.5">
              Upload Excel and cycle through cases
            </p>
          </div>
          <div class="flex items-center gap-1">
          <button
            type="button"
            id="helpToggle"
            class="hover:bg-gray-100 border border-gray-200 rounded-md p-1.5 cursor-pointer text-gray-500 hover:text-gray-700 flex items-center justify-center transition-colors"
            title="Help & Format Reference"
          >
            <svg
              aria-hidden="true"
              width="18px"
              height="18px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button
            type="button"
            id="settingsToggle"
            class="hover:bg-gray-100 border border-gray-200 rounded-md p-1.5 cursor-pointer text-gray-500 hover:text-gray-700 flex items-center justify-center transition-colors"
            title="Settings"
          >
            <svg
              aria-hidden="true"
              width="20px"
              height="20px"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 4a1 1 0 0 0-1 1c0 1.692-2.046 2.54-3.243 1.343a1 1 0 1 0-1.414 1.414C7.54 8.954 6.693 11 5 11a1 1 0 1 0 0 2c1.692 0 2.54 2.046 1.343 3.243a1 1 0 0 0 1.414 1.414C8.954 16.46 11 17.307 11 19a1 1 0 1 0 2 0c0-1.692 2.046-2.54 3.243-1.343a1 1 0 1 0 1.414-1.414C16.46 15.046 17.307 13 19 13a1 1 0 1 0 0-2c-1.692 0-2.54-2.046-1.343-3.243a1 1 0 0 0-1.414-1.414C15.046 7.54 13 6.693 13 5a1 1 0 0 0-1-1zm-2.992.777a3 3 0 0 1 5.984 0 3 3 0 0 1 4.23 4.231 3 3 0 0 1 .001 5.984 3 3 0 0 1-4.231 4.23 3 3 0 0 1-5.984 0 3 3 0 0 1-4.231-4.23 3 3 0 0 1 0-5.984 3 3 0 0 1 4.231-4.231z"
                fill="currentColor"
              />
              <path
                d="M12 10a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-2.828-.828a4 4 0 1 1 5.656 5.656 4 4 0 0 1-5.656-5.656z"
                fill="currentColor"
              />
            </svg>
          </button>
          </div>
        </div>
      </header>

      <!-- Settings Section -->
      <div
        id="settingsSection"
        class="hidden bg-gray-50 border-b px-6 py-4 space-y-4 overflow-y-auto max-h-[440px]"
      >
        <h2 class="text-lg font-semibold text-gray-900">Settings</h2>

        <div class="form-field">
          <label for="settingInstitution">Default Institution</label>
          <select id="settingInstitution">
            <option value="HUP">HUP</option>
            <option value="PPMC">PPMC</option>
            <option value="Penn Hospital">Pennsylvania Hospital</option>
            <option value="CHOP">CHOP</option>
          </select>
        </div>

        <div class="form-field">
          <label for="settingDefaultAttending">Default Attending</label>
          <input
            type="text"
            id="settingDefaultAttending"
            placeholder="LASTNAME, FIRSTNAME"
          />
        </div>

        <div class="form-field">
          <label for="settingSubmitDelay">
            Auto-submit delay:
            <span id="submitDelayValue" class="font-medium">0.5s</span>
          </label>
          <input
            type="range"
            id="settingSubmitDelay"
            min="0"
            max="2"
            step="0.5"
            value="0.5"
          />
        </div>

        <div class="space-y-2">
          <label class="checkbox-label">
            <input
              type="checkbox"
              id="settingCardiacAutoFill"
              checked
              class="rounded"
            />
            <span>
              Auto-fill cardiac case extras
              <span class="info-tooltip">
                <svg
              aria-hidden="true"
                  class="info-icon"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                >
                  <circle
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <path
                    d="M12 16v-4M12 8h.01"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
                <span class="tooltip-text"
                  >Automatically checks TEE, arterial line, central line, PA
                  catheter, and ultrasound guidance for cardiac cases</span
                >
              </span>
            </span>
          </label>

          <label class="checkbox-label">
            <input
              type="checkbox"
              id="settingAuto5EPathology"
              checked
              class="rounded"
            />
            <span>Auto-check Non-Trauma for 5E cases</span>
          </label>

          <label class="checkbox-label">
            <input
              type="checkbox"
              id="settingShowWarnings"
              checked
              class="rounded"
            />
            <span>Show warnings</span>
          </label>
        </div>

        <div class="flex gap-2 pt-2">
          <button
            type="button"
            id="clearSessionBtn"
            class="flex-1 inline-flex items-center justify-center gap-1.5 px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-yellow-400 text-yellow-900 hover:bg-yellow-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Clear Session
          </button>
          <button
            type="button"
            id="saveSettingsBtn"
            class="flex-1 inline-flex items-center justify-center gap-1.5 px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Save Settings
          </button>
        </div>
      </div>

      <!-- Help Section -->
      <div
        id="helpSection"
        class="hidden bg-sky-50 border-b px-5 py-4 overflow-y-auto max-h-[440px] text-xs"
      >
        <h2 class="text-sm font-semibold text-gray-900 mb-3">Help &amp; Format Reference</h2>

        <div class="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-md text-amber-800">
          This tool is for UPHS anesthesia residents only.
          Not affiliated with ACGME. Use only with authorized ADS credentials.
        </div>

        <div class="mb-4">
          <h3 class="font-semibold text-gray-800 mb-1">What This Does</h3>
          <p class="text-gray-600">
            Parses a standardized Excel or CSV case log and auto-fills the ACGME
            ADS Case Entry form case by case. You review each case in the popup
            before sending it to the open ADS tab.
          </p>
        </div>

        <div class="mb-4">
          <h3 class="font-semibold text-gray-800 mb-2">Required Columns</h3>
          <p class="text-gray-500 mb-2 italic">Column names are case-insensitive. Missing any required column blocks file load.</p>
          <table class="w-full border-collapse text-xs">
            <thead>
              <tr class="bg-gray-100">
                <th class="border border-gray-200 px-2 py-1 text-left font-semibold">Column</th>
                <th class="border border-gray-200 px-2 py-1 text-left font-semibold">Accepted Values</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <td class="border border-gray-200 px-2 py-1 font-mono">Case ID</td>
                <td class="border border-gray-200 px-2 py-1">Any string. Rows without a Case ID are skipped.</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <td class="border border-gray-200 px-2 py-1 font-mono">Case Date</td>
                <td class="border border-gray-200 px-2 py-1">M/D/YYYY, ISO 8601, or Excel serial number. Stored as M/D/YYYY.</td>
              </tr>
              <tr class="border-b">
                <td class="border border-gray-200 px-2 py-1 font-mono">Supervisor</td>
                <td class="border border-gray-200 px-2 py-1">Attending name. Fuzzy-matched against ADS dropdown. Format: LASTNAME, FIRSTNAME.</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <td class="border border-gray-200 px-2 py-1 font-mono">Age</td>
                <td class="border border-gray-200 px-2 py-1">
                  <span class="font-mono">a</span> (&lt;3mo) &middot;
                  <span class="font-mono">b</span> (3mo-3yr) &middot;
                  <span class="font-mono">c</span> (3-12yr) &middot;
                  <span class="font-mono">d</span> (12-65yr) &middot;
                  <span class="font-mono">e</span> (&ge;65yr)
                </td>
              </tr>
              <tr class="border-b">
                <td class="border border-gray-200 px-2 py-1 font-mono">Original Procedure</td>
                <td class="border border-gray-200 px-2 py-1">Free text. Stored in the Comments field in ADS.</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <td class="border border-gray-200 px-2 py-1 font-mono">ASA Physical Status</td>
                <td class="border border-gray-200 px-2 py-1 font-mono">1 2 3 4 5 6 1E 2E 3E 4E 5E</td>
              </tr>
              <tr class="border-b">
                <td class="border border-gray-200 px-2 py-1 font-mono">Anesthesia Type</td>
                <td class="border border-gray-200 px-2 py-1 font-mono">GA &middot; MAC &middot; Spinal &middot; Epidural &middot; CSE &middot; PNB Single &middot; PNB Continuous</td>
              </tr>
              <tr class="bg-gray-50">
                <td class="border border-gray-200 px-2 py-1 font-mono">Procedure Category</td>
                <td class="border border-gray-200 px-2 py-1">
                  Cardiac with CPB &middot; Cardiac without CPB &middot;
                  Procedures on major vessels (open) &middot; Procedures on major vessels (endovascular) &middot;
                  Intracerebral Vascular (open) &middot; Intracerebral Nonvascular (open) &middot; Intracerebral (endovascular) &middot;
                  Cesarean Delivery &middot; Vaginal Delivery &middot;
                  Intrathoracic non-cardiac &middot; Other (procedure cat)
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="mb-4">
          <h3 class="font-semibold text-gray-800 mb-2">Optional Columns</h3>
          <p class="text-gray-500 mb-2 italic">Multiple values separated by semicolons (;). Missing optional columns are treated as empty.</p>
          <table class="w-full border-collapse text-xs">
            <thead>
              <tr class="bg-gray-100">
                <th class="border border-gray-200 px-2 py-1 text-left font-semibold">Column</th>
                <th class="border border-gray-200 px-2 py-1 text-left font-semibold">Accepted Values</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <td class="border border-gray-200 px-2 py-1 font-mono">Airway Management</td>
                <td class="border border-gray-200 px-2 py-1">
                  ETT &middot; Nasal ETT &middot; Supraglottic Airway &middot; Mask &middot; DLT &middot;
                  Direct Laryngoscope &middot; Video Laryngoscope &middot; Flexible Bronchoscopic
                  <br/><span class="text-amber-700 font-semibold">Special token:</span>
                  <span class="font-mono">Difficult Airway</span> sets Unanticipated difficult airway and is removed from the airway list.
                </td>
              </tr>
              <tr class="border-b bg-gray-50">
                <td class="border border-gray-200 px-2 py-1 font-mono">Specialized Vascular Access</td>
                <td class="border border-gray-200 px-2 py-1">
                  Arterial Catheter &middot; Central Venous Catheter &middot; PA Catheter &middot; Ultrasound Guided
                </td>
              </tr>
              <tr>
                <td class="border border-gray-200 px-2 py-1 font-mono">Specialized Monitoring Techniques</td>
                <td class="border border-gray-200 px-2 py-1">
                  TEE &middot; Neuromonitoring &middot; CSF Drain
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="mb-3">
          <h3 class="font-semibold text-gray-800 mb-1">Tips</h3>
          <ul class="space-y-1 text-gray-600 list-disc list-inside">
            <li>Only the first sheet of the workbook is read.</li>
            <li>Extra columns beyond the expected ones are ignored.</li>
            <li>The Supervisor field uses fuzzy matching - exact last name matches work best.</li>
            <li>For bulk submission (BEAST Mode), obtain program approval first.</li>
            <li>Use <strong>Fill Form</strong> first to verify mappings before submitting.</li>
            <li>Arrow keys navigate between cases when no input is focused.</li>
          </ul>
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex-1 overflow-y-auto">
        <!-- Upload Section -->
        <div id="uploadSection" class="px-6 py-8">
          <div class="text-center space-y-4">
            <div
              class="mx-auto w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center"
            >
              <svg
              aria-hidden="true"
                class="w-8 h-8 text-primary-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-medium text-gray-900">Load Cases</h3>
              <p class="text-sm text-gray-500 mt-1">
                Upload an Excel file to get started
              </p>
            </div>
            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" />
            <button
              type="button"
              id="uploadBtn"
              class="inline-flex items-center justify-center gap-1.5 px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Choose Excel File
            </button>
            <div id="fileName" class="text-sm text-gray-600 mt-2"></div>
          </div>
        </div>

        <!-- Navigation Section -->
        <div id="navSection" class="hidden border-b bg-gray-50 px-6 py-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-sm font-medium text-gray-700">Cases</h3>
            <div class="flex gap-4 text-xs">
              <span class="stat pending px-1.5 py-0.5 rounded font-medium"
                ><span id="pendingCount">0</span> pending</span
              >
              <span class="stat submitted px-1.5 py-0.5 rounded font-medium"
                ><span id="submittedCount">0</span> submitted</span
              >
              <span class="stat skipped px-1.5 py-0.5 rounded font-medium"
                ><span id="skippedCount">0</span> skipped</span
              >
            </div>
          </div>

          <div class="flex items-center gap-3">
            <button
              type="button"
              id="prevBtn"
              class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-gray-200 text-gray-600 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Previous
            </button>
            <div class="flex-1 text-center text-sm font-medium text-gray-700">
              <span id="currentIndex">0</span> / <span id="totalCount">0</span>
            </div>
            <button
              type="button"
              id="nextBtn"
              class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-gray-200 text-gray-600 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Next
            </button>
          </div>

          <div class="flex items-center gap-3 mt-3">
            <label for="caseJump" class="text-sm text-gray-600">Jump to:</label>
            <select id="caseJump" class="flex-1 text-sm"></select>
            <label class="checkbox-label text-xs">
              <input
                type="checkbox"
                id="filterPending"
                checked
                class="rounded"
              />
              <span>Pending only</span>
            </label>
          </div>
        </div>

        <!-- Case Preview Section -->
        <div id="previewSection" class="hidden px-6 py-4 space-y-4">
          <div class="flex items-center justify-between">
            <span id="caseStatus" class="status-badge pending">Pending</span>
            <h3 class="text-sm font-medium text-gray-700">Case Details</h3>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-field">
              <label for="caseId">Case ID</label>
              <input type="text" id="caseId" />
            </div>
            <div class="form-field">
              <label for="date">Date</label>
              <input type="text" id="date" placeholder="MM/DD/YYYY" />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-field col-span-2">
              <label for="attending">Attending</label>
              <input type="text" id="attending" />
            </div>
            <div class="form-field">
              <label for="ageCategory">
                Age
                <span class="info-tooltip">
                  <svg
              aria-hidden="true"
                    class="info-icon"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M12 16v-4M12 8h.01"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                  <span class="tooltip-text"
                    >ACGME age categories: a=&lt;3mo, b=3mo-3yr, c=3-12yr,
                    d=12-65yr, e=≥65yr</span
                  >
                </span>
              </label>
              <select id="ageCategory">
                <option value="">Select</option>
                <option value="a">a. &lt; 3 mo</option>
                <option value="b">b. 3mo - 3yr</option>
                <option value="c">c. 3 - 12yr</option>
                <option value="d">d. 12 - 65yr</option>
                <option value="e">e. >= 65yr</option>
              </select>
            </div>
            <div class="form-field">
              <label for="asa">ASA</label>
              <select id="asa">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="1E">1E</option>
                <option value="2E">2E</option>
                <option value="3E">3E</option>
                <option value="4E">4E</option>
                <option value="5E">5E</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-field">
              <label for="anesthesia">Anesthesia Type</label>
              <select id="anesthesia">
                <option value="">Select</option>
                <option value="GA">GA</option>
                <option value="MAC">MAC</option>
                <option value="Spinal">Spinal</option>
                <option value="Epidural">Epidural</option>
                <option value="CSE">CSE</option>
                <option value="PNB Single">PNB Single</option>
                <option value="PNB Continuous">PNB Continuous</option>
              </select>
            </div>
            <div class="form-field">
              <label for="procedureCategory">
                Procedure Category
                <span class="info-tooltip">
                  <svg
              aria-hidden="true"
                    class="info-icon"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M12 16v-4M12 8h.01"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                  <span class="tooltip-text"
                    >Major ACGME procedure types. CPB=Cardiopulmonary Bypass.
                    Open vs endovascular approach matters for vascular/cerebral
                    cases.</span
                  >
                </span>
              </label>
              <select id="procedureCategory" class="text-sm">
                <option value="">Select</option>
                <option value="Other (procedure cat)">Other</option>
                <option value="Intrathoracic non-cardiac">Intrathoracic</option>
                <option value="Cardiac with CPB">Cardiac with CPB</option>
                <option value="Cardiac without CPB">Cardiac without CPB</option>
                <option value="Procedures Major Vessels">
                  Major Vessels (open)*
                </option>
                <option value="Procedures on major vessels (open)">
                  Major Vessels (open)
                </option>
                <option value="Procedures on major vessels (endovascular)">
                  Major Vessels (endo)
                </option>
                <option value="Intracerebral">
                  Intracerebral Nonvasc*
                </option>
                <option value="Intracerebral Vascular (open)">
                  Intracerebral Vascular
                </option>
                <option value="Intracerebral Nonvascular (open)">
                  Intracerebral Nonvasc
                </option>
                <option value="Intracerebral (endovascular)">
                  Intracerebral (endo)
                </option>
                <option value="Cesarean Delivery">Cesarean Delivery</option>
                <option value="Vaginal Delivery">Vaginal Delivery</option>
              </select>
            </div>
          </div>

          <div class="form-field">
            <label>Airway Management</label>
            <div class="flex flex-wrap gap-3 mt-1">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="ETT"
                  class="rounded"
                />
                <span>ETT</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="Nasal ETT"
                  class="rounded"
                />
                <span>Nasal ETT</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="Supraglottic Airway"
                  class="rounded"
                />
                <span>Supraglottic</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="Mask"
                  class="rounded"
                />
                <span>Mask</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="DLT"
                  class="rounded"
                />
                <span>DLT</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="Direct Laryngoscope"
                  class="rounded"
                />
                <span>Direct</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="Video Laryngoscope"
                  class="rounded"
                />
                <span>Video</span>
              </label>
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="airway"
                  value="Flexible Bronchoscopic"
                  class="rounded"
                />
                <span>FOB</span>
              </label>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-field">
              <label>Vascular Access</label>
              <div class="space-y-1.5 mt-1">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="vascular"
                    value="Arterial Catheter"
                    class="rounded"
                  />
                  <span>Arterial</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="vascular"
                    value="Central Venous Catheter"
                    class="rounded"
                  />
                  <span>Central</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="vascular"
                    value="PA Catheter"
                    class="rounded"
                  />
                  <span>PA Cath</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="vascular"
                    value="Ultrasound Guided"
                    class="rounded"
                  />
                  <span>US Guided</span>
                </label>
              </div>
            </div>
            <div class="form-field">
              <label>Monitoring</label>
              <div class="space-y-1.5 mt-1">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="monitoring"
                    value="TEE"
                    class="rounded"
                  />
                  <span>TEE</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="monitoring"
                    value="Neuromonitoring"
                    class="rounded"
                  />
                  <span>Neuro</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    name="monitoring"
                    value="CSF Drain"
                    class="rounded"
                  />
                  <span>CSF Drain</span>
                </label>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="form-field">
              <label>
                Difficult Airway
                <span class="info-tooltip">
                  <svg
              aria-hidden="true"
                    class="info-icon"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M12 16v-4M12 8h.01"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                  <span class="tooltip-text"
                    >Anticipated: known difficulty. Unanticipated: unexpected
                    difficulty during procedure. None: standard airway.</span
                  >
                </span>
              </label>
              <div class="space-y-1.5 mt-1">
                <label class="checkbox-label">
                  <input
                    type="radio"
                    name="difficultAirway"
                    value="Anticipated"
                    class="rounded-full"
                  />
                  <span>Anticipated</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="radio"
                    name="difficultAirway"
                    value="Unanticipated"
                    class="rounded-full"
                  />
                  <span>Unanticipated</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="radio"
                    name="difficultAirway"
                    value=""
                    checked
                    class="rounded-full"
                  />
                  <span>None</span>
                </label>
              </div>
            </div>
            <div class="form-field">
              <label>Life-Threatening Pathology</label>
              <div class="space-y-1.5 mt-1">
                <label class="checkbox-label">
                  <input
                    type="radio"
                    name="lifeThreateningPathology"
                    value="Non-Trauma"
                    class="rounded-full"
                  />
                  <span>Non-Trauma</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="radio"
                    name="lifeThreateningPathology"
                    value="Trauma"
                    class="rounded-full"
                  />
                  <span>Trauma</span>
                </label>
                <label class="checkbox-label">
                  <input
                    type="radio"
                    name="lifeThreateningPathology"
                    value=""
                    checked
                    class="rounded-full"
                  />
                  <span>None</span>
                </label>
              </div>
            </div>
          </div>

          <div class="form-field">
            <label for="comments">Comments</label>
            <textarea id="comments" rows="2" class="text-sm"></textarea>
          </div>

          <!-- Bottom Navigation -->
          <div class="flex items-center gap-3 py-3 border-t border-gray-200">
            <button
              type="button"
              id="prevBtnBottom"
              class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-gray-200 text-gray-600 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Previous
            </button>
            <div class="flex-1 text-center text-sm font-medium text-gray-700">
              <span id="currentIndexBottom">0</span> / <span id="totalCountBottom">0</span>
            </div>
            <button
              type="button"
              id="nextBtnBottom"
              class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-gray-200 text-gray-600 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Next
            </button>
          </div>

          <!-- Validation Summary -->
          <div
            id="validationSummary"
            class="hidden mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md"
          >
            <div class="flex items-start gap-2">
              <svg
              aria-hidden="true"
                class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd"
                />
              </svg>
              <div class="flex-1">
                <p
                  class="text-sm font-medium text-yellow-800"
                  id="validationText"
                ></p>
              </div>
            </div>
          </div>

          <div class="flex gap-2 pt-2">
            <button
              type="button"
              id="skipBtn"
              class="flex-1 inline-flex items-center justify-center gap-1.5 px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-yellow-400 text-yellow-900 hover:bg-yellow-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Skip
            </button>
            <button
              type="button"
              id="fillBtn"
              class="flex-1 inline-flex items-center justify-center gap-1.5 px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Fill Form
            </button>
            <button
              type="button"
              id="fillSubmitBtn"
              class="flex-1 inline-flex items-center justify-center gap-1.5 px-4 py-2 border-0 rounded-md text-sm font-medium cursor-pointer transition-all bg-primary-600 text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"
              title="Fill and submit case to ACGME"
            >
              Submit
            </button>
          </div>

          <!-- BEAST Mode -->
          <div class="mt-3 pt-3 border-t border-gray-200">
            <button
              type="button"
              id="beastModeBtn"
              class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 border-2 border-red-500 rounded-md text-sm font-bold cursor-pointer transition-all bg-red-500 text-white hover:bg-red-600 hover:border-red-600 disabled:opacity-50 disabled:cursor-not-allowed"
              title="Automatically fill and submit all pending cases"
            >
              <span id="beastModeText">START BEAST MODE</span>
            </button>
            <p class="text-xs text-gray-500 text-center mt-2">
              Bulk auto-fills and submits all pending cases. Verify sample
              cases with Fill Form first. You are responsible for accuracy.
            </p>
          </div>
        </div>
      </div>

      <!-- Status Message -->
      <div id="statusSection" class="hidden border-t px-6 py-3">
        <div id="statusMessage" class="text-sm"></div>
      </div>

      <footer class="border-t px-6 py-2 bg-gray-50">
        <p class="text-xs text-gray-500 text-center">v1.3.1 - UPHS Anesthesia | Not affiliated with ACGME</p>
      </footer>
    </div>

    <script data-vite-ignore src="/xlsx.min.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>
